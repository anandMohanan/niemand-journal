---
import Layout from '../layouts/Layout.astro';

const modules = import.meta.glob('/src/posts/*.md', { eager: true });
const posts = Object.entries(modules).map(([path, mod]) => {
  const slug = path.split('/').pop()?.replace('.md', '') || '';
  return {
    slug,
    ...mod.frontmatter,
    content: mod.content,
  };
});
const sortedPosts = posts.sort((a, b) => 
  new Date(b.date).getTime() - new Date(a.date).getTime()
);

export async function getStaticPaths() {
  return sortedPosts.map(post => ({
    params: { slug: post.slug },
    props: { post },
  }));
}

const { post } = Astro.props;
---

<Layout title={post.title} excerpt={post.excerpt}>
  <article>
    <h1>{post.title}</h1>
    <p class="meta">{post.date}</p>
    <div class="content" set:html={post.content} />
  </article>
</Layout>
